import React, { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\nimport {\n  useTable,\n  useGlobalFilter,\n  useSortBy,\n  usePagination,\n} from 'react-table';\nimport { saveAs } from 'file-saver';\nimport * as XLSX from 'xlsx';\n\n// Simple global filter input\nfunction GlobalFilter({ preGlobalFilteredRows, globalFilter, setGlobalFilter }) {\n  return (\n    <span>\n      Search:{' '}\n      <input\n        value={globalFilter || ''}\n        onChange={e => setGlobalFilter(e.target.value || undefined)}\n        placeholder={`${preGlobalFilteredRows.length} records...`}\n        style={{ fontSize: '1rem', margin: '0 8px' }}\n      />\n    </span>\n  );\n}\n\nexport default function DataTable() {\n  const data = useSelector(state => state.table.data);\n\n  const columns = useMemo(\n    () => [\n      { Header: 'ID', accessor: 'id' },\n      { Header: 'First Name', accessor: 'firstName' },\n      { Header: 'Last Name', accessor: 'lastName' },\n      { Header: 'Email', accessor: 'email' },\n      { Header: 'Age', accessor: 'age' },\n      { Header: 'City', accessor: 'city' },\n    ],\n    []\n  );\n\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    rows,         // rows after filtering & sorting (not paginated)\n    prepareRow,\n    page,         // rows for current page\n    nextPage,\n    previousPage,\n    canNextPage,\n    canPreviousPage,\n    gotoPage,\n    setPageSize,\n    state,\n    setGlobalFilter,\n    preGlobalFilteredRows,\n    pageOptions,\n    state: { pageIndex, pageSize, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageIndex: 0, pageSize: 10 }, // 10 rows per page\n    },\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  // Export the currently filtered rows (rows variable is filtered & sorted but not paginated)\n  const exportFilteredToExcel = () => {\n    const exportData = rows.map(r => r.original);\n    const ws = XLSX.utils.json_to_sheet(exportData);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, 'FilteredData');\n    const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\n    const blob = new Blob([wbout], { type: 'application/octet-stream' });\n    saveAs(blob, 'filtered-data.xlsx');\n  };\n\n  return (\n    <div className="data-table">\n      <div className="table-controls">\n        <GlobalFilter\n          preGlobalFilteredRows={preGlobalFilteredRows}\n          globalFilter={globalFilter}\n          setGlobalFilter={setGlobalFilter}\n        />\n        <div style={{ marginLeft: 'auto' }}>\n          <button onClick={exportFilteredToExcel}>Download Excel (filtered)</button>\n        </div>\n      </div>\n\n      <div className="table-wrapper">\n        <table {...getTableProps()} className="responsive-table">\n          <thead>\n            {headerGroups.map(headerGroup => (\n              <tr {...headerGroup.getHeaderGroupProps()}>\n                {headerGroup.headers.map(column => (\n                  <th\n                    {...column.getHeaderProps(column.getSortByToggleProps())}\n                    className="sortable"\n                  >\n                    {column.render('Header')}\n                    <span>\n                      {column.isSorted\n                        ? column.isSortedDesc\n                          ? ' ðŸ”½'\n                          : ' ðŸ”¼'\n                        : ''}\n                    </span>\n                  </th>\n                ))}\n              </tr>\n            ))}\n          </thead>\n\n          <tbody {...getTableBodyProps()}>\n            {page.map(row => {\n              prepareRow(row);\n              return (\n                <tr {...row.getRowProps()}>\n                  {row.cells.map(cell => (\n                    <td {...cell.getCellProps()}>{cell.render('Cell')}</td>\n                  ))}\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n\n      <div className="pagination">\n        <button onClick={() => gotoPage(0)} disabled={!canPreviousPage}>\n          {'<<'}\n        </button>{' '}\n        <button onClick={() => previousPage()} disabled={!canPreviousPage}>Prev</button>{' '}\n        <button onClick={() => nextPage()} disabled={!canNextPage}>Next</button>{' '}\n        <button onClick={() => gotoPage(pageOptions.length - 1)} disabled={!canNextPage}>{'>>'}</button>{' '}\n        <span>Page <strong>{pageIndex + 1} of {pageOptions.length}</strong></span>\n        <select value={pageSize} onChange={e => {\n          setPageSize(Number(e.target.value));\n        }}>\n          {[10, 20, 30].map(size => (\n            <option key={size} value={size}>Show {size}</option>\n          ))}\n        </select>\n      </div>\n    </div>\n  );\n}